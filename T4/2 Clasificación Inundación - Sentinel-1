/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var area = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-80.24208703813648, 32.29200761739589],
          [-78.83583703813648, 33.38581471920781],
          [-80.41786828813648, 33.911681513204265],
          [-81.26930871782398, 33.11477854279269]]]),
    aguaPermanente = 
    /* color: #112eff */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.06478695074304, 33.31057492592732],
                  [-80.08607296148523, 33.30311476765309],
                  [-80.06684688726648, 33.29221031144918],
                  [-80.04899410406335, 33.294506099715555],
                  [-80.05998043218835, 33.30655799693119]]]),
            {
              "clase": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.54081161169461, 32.964137584167474],
                  [-79.5456181302493, 32.95203858569862],
                  [-79.52776534704617, 32.94685279357084],
                  [-79.52295882849148, 32.95722407359552]]]),
            {
              "clase": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.91259405988308, 32.766746424413704],
                  [-79.91637061017605, 32.762127208050956],
                  [-79.9081308640823, 32.759095717065804],
                  [-79.90864584821315, 32.762993329374986],
                  [-79.9110491074905, 32.76645773041271]]]),
            {
              "clase": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.29951880353542, 33.4683613871701],
                  [-80.30501196759792, 33.46206043359505],
                  [-80.29642889875026, 33.45948263875606],
                  [-80.29024908917995, 33.46435174243623]]]),
            {
              "clase": 1,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.26118343259981, 32.52030177934102],
                  [-80.26358669187715, 32.511906174529905],
                  [-80.2550036230295, 32.51132713839524],
                  [-80.25054042722871, 32.51943330486608]]]),
            {
              "clase": 1,
              "system:index": "4"
            })]),
    aguaInundacion = 
    /* color: #53ffe7 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.43386968852639, 32.67136608780426],
                  [-80.43833288432717, 32.668765027838894],
                  [-80.43670210124611, 32.66739221566369],
                  [-80.42983564616799, 32.6694875520912]]]),
            {
              "clase": 2,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.43841871501564, 32.67403932053026],
                  [-80.43695959331154, 32.675917760538574],
                  [-80.4411652970469, 32.68227526439385],
                  [-80.44339689494728, 32.68046920136099]]]),
            {
              "clase": 2,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.43531130552287, 32.64806888358427],
                  [-80.43625544309612, 32.646840294533895],
                  [-80.43505381345744, 32.645973045041956],
                  [-80.4337663531303, 32.647057105592786]]]),
            {
              "clase": 2,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.39411257505412, 32.62840943352884],
                  [-80.39514254331584, 32.62515653450622],
                  [-80.39170931577678, 32.62522882243561],
                  [-80.39119433164592, 32.62761429135241],
                  [-80.3930826067924, 32.6291322839223]]]),
            {
              "clase": 2,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.38741778135295, 32.62848171883091],
                  [-80.38673113584514, 32.62971056003322],
                  [-80.38861941099162, 32.63252960256113],
                  [-80.39050768613811, 32.63093938436151]]]),
            {
              "clase": 2,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.41814516782756, 32.65124868274652],
                  [-80.41917513608928, 32.64944199254853],
                  [-80.41634272336955, 32.64922518727169],
                  [-80.4150552630424, 32.65124868274652]]]),
            {
              "clase": 2,
              "system:index": "5"
            })]),
    vegetacionInundacion = 
    /* color: #ff4ae9 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.47210815985625, 33.0483110112717],
                  [-79.47725800116484, 33.04615265790978],
                  [-79.47399643500273, 33.041260194462495],
                  [-79.47021988470976, 33.045433195034576],
                  [-79.46524170477812, 33.050325426684736],
                  [-79.46747330267851, 33.0517642666244]]]),
            {
              "clase": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.41648987372344, 33.07320019644196],
                  [-79.41923645575469, 33.07075475017701],
                  [-79.41666153510039, 33.067446097048396],
                  [-79.41168335516875, 33.0673022397425],
                  [-79.41116837103789, 33.07032319378067]]]),
            {
              "clase": 3,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.43777588446562, 33.02744471324213],
                  [-79.44258240302031, 33.031474452359234],
                  [-79.44515732367461, 33.03348925281785],
                  [-79.45013550360625, 33.02974744387187],
                  [-79.44859055121367, 33.02758863566918],
                  [-79.4444706781668, 33.02600547604564],
                  [-79.44120911200469, 33.02456621534749]]]),
            {
              "clase": 3,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.40945175726836, 33.02802040154018],
                  [-79.41425827582304, 33.02974744387187],
                  [-79.42112473090117, 33.02427836038771],
                  [-79.41975143988554, 33.021255826555915],
                  [-79.41751984198515, 33.023702647648015],
                  [-79.4144299372, 33.02427836038771],
                  [-79.4092800958914, 33.02528584863424]]]),
            {
              "clase": 3,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.43108109076445, 33.044282042209744],
                  [-79.42678955634062, 33.04586487346496],
                  [-79.42524460394804, 33.0483110112717],
                  [-79.42318466742461, 33.05291532164823],
                  [-79.42644623358672, 33.05421024056378],
                  [-79.42936447699492, 33.05147650051734]]]),
            {
              "clase": 3,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.49476746161406, 33.02773255786122],
                  [-79.49219254095976, 33.02327086062569],
                  [-79.48669937689726, 33.0228390714883],
                  [-79.48858765204375, 33.027300790580085]]]),
            {
              "clase": 3,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.62215706785173, 32.952226115884514],
                  [-79.62919518430681, 32.95280229500815],
                  [-79.6288518615529, 32.947328441690786],
                  [-79.62061211545915, 32.94848086003128],
                  [-79.62215706785173, 32.95323442688601]]]),
            {
              "clase": 3,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.67387717220629, 32.91977123564119],
                  [-79.6797136590227, 32.91429533775534],
                  [-79.67319052669848, 32.91285425568891],
                  [-79.67010062191332, 32.918762543065796]]]),
            {
              "clase": 3,
              "system:index": "7"
            })]),
    urbano = 
    /* color: #f6ef0c */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.05590956661547, 33.051450786651486],
                  [-80.0524763390764, 33.05166661138297],
                  [-80.05050223324145, 33.05159466986458],
                  [-80.05041640255297, 33.05252990501898],
                  [-80.0521330163225, 33.053033489064546],
                  [-80.05590956661547, 33.053033489064546]]]),
            {
              "clase": 4,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.0579695031389, 33.05166661138297],
                  [-80.05882781002367, 33.049796112802426],
                  [-80.05771201107348, 33.04943639698178],
                  [-80.05668204281176, 33.049724169755855],
                  [-80.05530875179613, 33.05166661138297]]]),
            {
              "clase": 4,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.0432965822485, 33.0627414450711],
                  [-80.04458404257565, 33.062813377481035],
                  [-80.04660106375485, 33.06259758007487],
                  [-80.04672980978756, 33.062237916555524],
                  [-80.04527068808346, 33.06220195012278],
                  [-80.04471278860836, 33.061626485199746],
                  [-80.04458404257565, 33.06234581576565]]]),
            {
              "clase": 4,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.05801654532223, 33.0529580896835],
                  [-80.05844569876461, 33.052814208698294],
                  [-80.05827403738766, 33.051950917849716],
                  [-80.05750156119137, 33.052382564332014],
                  [-80.05599952414303, 33.052454505206676],
                  [-80.05582786276608, 33.05310197043357]]]),
            {
              "clase": 4,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.94132972433835, 33.05534571895993],
                  [-79.94115806296139, 33.05606510085045],
                  [-79.94158721640378, 33.05764772031843],
                  [-79.94278884604245, 33.0572160996487]]]),
            {
              "clase": 4,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.92818434459701, 33.01522336549217],
                  [-79.92758352977768, 33.01536730787307],
                  [-79.92865641338364, 33.01655482354972],
                  [-79.92990095836655, 33.016770733772624],
                  [-79.93002970439926, 33.016123001517755]]]),
            {
              "clase": 4,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.88441069347397, 33.00734216153977],
                  [-79.8850115082933, 33.006766338209744],
                  [-79.8844536088182, 33.00547072197292],
                  [-79.88402445537582, 33.005506711569794],
                  [-79.88423903209701, 33.00629847898614]]]),
            {
              "clase": 4,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.8875864289476, 33.00745012799565],
                  [-79.88750059825912, 33.00701826137918],
                  [-79.88685686809555, 33.00730617269177],
                  [-79.88617022258774, 33.006766338209744],
                  [-79.88569815380112, 33.00698227239902],
                  [-79.88664229137436, 33.00784600386984]]]),
            {
              "clase": 4,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.96721921577972, 32.90191518898719],
                  [-79.96799169197601, 32.902311537859646],
                  [-79.96816335335296, 32.902059316055144],
                  [-79.96790586128753, 32.90133867836973],
                  [-79.96824918404144, 32.90079819625741],
                  [-79.96747670784515, 32.90004151575877],
                  [-79.96691880837005, 32.900221678368645],
                  [-79.96627507820648, 32.89953705850136],
                  [-79.96576009407562, 32.89928482879518],
                  [-79.96554551735443, 32.90043787301673],
                  [-79.96721921577972, 32.90123058221114]]]),
            {
              "clase": 4,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.96751962318939, 32.899789287489234],
                  [-79.9678629459433, 32.89942896014383],
                  [-79.96597467079681, 32.898239869503065],
                  [-79.96554551735443, 32.898780367227886],
                  [-79.96644673958343, 32.899609123999774]]]),
            {
              "clase": 4,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.00336710484498, 32.8697484192575],
                  [-80.00135008366578, 32.86927983460268],
                  [-80.00130716832155, 32.869640284556944],
                  [-80.00289503605836, 32.87086580344122],
                  [-80.0055128720569, 32.874398086625185],
                  [-80.00602785618776, 32.874398086625185],
                  [-80.00619951756471, 32.87331679039293]]]),
            {
              "clase": 4,
              "system:index": "10"
            })]),
    canalDeInundacion = 
    /* color: #68e818 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.85940614041579, 33.030698859971444],
                  [-79.85674538907301, 33.0260214258598],
                  [-79.85417046841872, 33.0268849708417],
                  [-79.85631623563063, 33.029907311649445]]]),
            {
              "clase": 5,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.92386498746168, 33.05271544495935],
                  [-79.92729821500075, 33.04926222690842],
                  [-79.92317834195387, 33.04480161983676],
                  [-79.92146172818434, 33.04911833988415]]]),
            {
              "clase": 5,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.64028039273512, 33.10363467685824],
                  [-79.64543023404372, 33.09529399703261],
                  [-79.63787713345778, 33.09558161985737]]]),
            {
              "clase": 5,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.69212212857497, 33.227501079979184],
                  [-79.68765893277418, 33.2223315078925],
                  [-79.68079247769606, 33.22405473253382],
                  [-79.68903222378981, 33.22922420278146]]]),
            {
              "clase": 5,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.72027459439528, 33.25449276982084],
                  [-79.71512475308668, 33.24788919030563],
                  [-79.70825829800856, 33.2516217096083],
                  [-79.71306481656325, 33.25650245583962],
                  [-79.71924462613356, 33.25650245583962]]]),
            {
              "clase": 5,
              "system:index": "4"
            })]),
    vegetacionBaja = 
    /* color: #1c9235 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.63647221477862, 33.373741499833834],
                  [-79.64780186565753, 33.376608541101795],
                  [-79.65054844768878, 33.36915403723351],
                  [-79.64436863811846, 33.3668602152124],
                  [-79.6405920878255, 33.37144779877469]]]),
            {
              "clase": 6,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.84995902797505, 33.05639925921987],
                  [-79.8475557686977, 33.04747854218644],
                  [-79.83965934535786, 33.05208289608919],
                  [-79.84000266811177, 33.05870123303042],
                  [-79.84995902797505, 33.05841348959595]]]),
            {
              "clase": 6,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.8515612666265, 33.176449055532814],
                  [-80.87559385939994, 33.181046654542925],
                  [-80.86666746779838, 33.1626548112821],
                  [-80.84812803908744, 33.16552879117165]]]),
            {
              "clase": 6,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.51029844924369, 33.01653277679807],
                  [-80.51441832229057, 33.00271341943921],
                  [-80.50274534865775, 32.999834114120276],
                  [-80.50137205764213, 33.01307814046448]]]),
            {
              "clase": 6,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.73002501174369, 33.057977853465815],
                  [-80.72865172072807, 33.04646728793885],
                  [-80.71766539260307, 33.044740573333144],
                  [-80.71491881057182, 33.055675860739775],
                  [-80.73002501174369, 33.06258165833386]]]),
            {
              "clase": 6,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.51516270891153, 32.76468788837625],
                  [-80.51172948137247, 32.755449002380296],
                  [-80.5021164442631, 32.75198417299905],
                  [-80.50280308977091, 32.76180083947985]]]),
            {
              "clase": 6,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.58726048723184, 32.789512643729736],
                  [-80.58314061418497, 32.783740062857504],
                  [-80.57284093156778, 32.783740062857504],
                  [-80.57421422258341, 32.79239879368001],
                  [-80.58588719621622, 32.79355322743472]]]),
            {
              "clase": 6,
              "system:index": "6"
            })]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
////////////////////////////////////////////////////////////////////////////////
// Talleres de Capacitación Geoespacial de República Dominicana
// Taller: (T4) Intermedio Google Earth Engine - Mapeo de Cuerpos de Agua
// Organizado por: SERVIR-Amazonia, INTEC
// Autora: Andréa Puzzi Nicolau (Spatial Informatics Group)
// Titulo: Clasificación Inundación - Sentinel-1
////////////////////////////////////////////////////////////////////////////////

// Carga Sentinel-1 banda C SAR Ground Range recogida (escala logarítmica, VV, ascendente).
var coleccion = ee.ImageCollection('COPERNICUS/S1_GRD')
    .filter(ee.Filter.eq('instrumentMode', 'IW'))
    .filter(ee.Filter.eq('orbitProperties_pass', 'ASCENDING'))
    .filterMetadata('resolution_meters', 'equals' , 10)
    .filterBounds(area)
    .select('VV', 'VH');
  
// Filtrar por fechas.
var antes = coleccion.filterDate('2016-10-04', '2016-10-05').mosaic().clip(area);
var despues = coleccion.filterDate('2016-10-16', '2016-10-17').mosaic().clip(area);

// Definir parámetros de visualización.
var paramsVis = {bands: ['VV'], min: -20, max: 0};

// Mostrar en el mapa.
Map.centerObject(area, 9);
Map.addLayer(antes, paramsVis, 'Antes de la inundación');
Map.addLayer(despues, paramsVis, 'Despues de la inundación');

// Aplicar filtro para reducir el moteado.
var radioAlisamiento = 50;
var antesAlisado = antes.focal_mean(radioAlisamiento, 'circle', 'meters');
var despuesAlisado = despues.focal_mean(radioAlisamiento, 'circle', 'meters');

// Mostrar imágenes alisadas en el mapa.
Map.addLayer(antesAlisado, paramsVis, 'Antes Alisado');
Map.addLayer(despuesAlisado, paramsVis, 'Despues Alisado');
 
// Fusionar FeatureCollections.
var datosRef = aguaPermanente.merge(aguaInundacion).merge(vegetacionInundacion).merge(urbano).merge(canalDeInundacion).merge(vegetacionBaja);

// Concatenar las imágenes.
var final = ee.Image.cat(antesAlisado, despuesAlisado);

// Define las bandas que se utilizarán para entrenar tus datos.
var bandas = ['VV', 'VH'];

// Crear muestra de entrenamiento.
var entrenamiento = final.select(bandas).sampleRegions({
  collection: datosRef,
  properties: ['clase'],
  scale: 30 });
  
// Entrenar el modelo.
var classifier = ee.Classifier.smileRandomForest(65).train({
  features: entrenamiento,
  classProperty: 'clase',
  inputProperties: bandas
});

// Hacer la clasificación.
var clasificacion = final.select(bandas).classify(classifier);

// Mostrar la imagen clasificada en el mapa.
Map.addLayer(clasificacion, 
{min: 1, max: 6, palette: ['112eff', '53ffe7', 'ff4ae9', 'f6ef0c', '68e818', '1c9235']},
'Clasificación');

// Añadir capa de población.
var poblacion = ee.ImageCollection('CIESIN/GPWv4/population-density');
var densidadePoblacion = poblacion.select('population-density');
var visPob = {
  min: 200.0,
  max: 1500.0,
  palette: ['ffffff', 'ffcdc6', 'ff0000', '950000'],
};

Map.addLayer(densidadePoblacion, visPob, 'Densidade de Población');

// Añadir capa de carreteras.
var carreteras = ee.FeatureCollection('TIGER/2016/Roads');
var carreteras = carreteras.style({color: '#4285F4', width: 1});
Map.addLayer(carreteras, {}, 'TIGER/2016/Roads');
